!function(a,b){"use strict";function I(b,d){var f,g,e=this;return!e instanceof I?new I(b,d):(z(d)&&(d={valid:d}),d=d||{},d.valid&&(e.isAjaxSubmit=!0),g=E(b,"data-"+c+"-option"),g=g&&"{"===g.charAt(0)?new Function("return "+g)():{},f=H[d.theme||g.theme||G.theme],e.options=a.extend({},G,f,g,d),e.$el=a(b),e.rules=new J(e.options.rules,!0),e.messages=new K(e.options.messages,!0),e.elements={},e.fields={},e.deferred={},e.errors={},e.isValid=!0,e._init(),void 0)}function J(a,b){var c=b?b===!0?this:b:J.prototype;if(C(a))for(var d in a)c[d]=L(a[d])}function K(a,b){var c=b?b===!0?this:b:K.prototype;if(C(a))for(var d in a){if(!a[d])return;c[d]=a[d]}}function L(b){switch(a.type(b)){case"function":return b;case"array":return function(a){return b[0].test(a.value)||b[1]||!1};case"regexp":return function(a){return b.test(a.value)}}}function M(b){var c="";return a.map(b.split(" "),function(a){c+=","+("#"===a.charAt(0)?a:'[name="'+a+'"]')}),c.substring(1)}function N(b){if(b&&b.tagName){var d=b;switch(b.tagName){case"INPUT":case"SELECT":case"TEXTAREA":d=b.form||a(b).closest(".n-"+c);break;default:d=a(b).closest(".n-"+c)}return a(d).data(c)||a(d)[c]().data(c)}}function O(b,c){var d=a.trim(E(b,l+"-"+c));if(d)return d=new Function("return "+d)(),d?L(d):void 0}function P(a,b,c){var d=b.msg;return C(d)&&c&&(d=d[c]),B(d)||(d=E(a,"data-msg-"+c)||E(a,"data-msg")||""),d}function Q(a){var b;return a&&(b=u.exec(a)),b?b[1]:""}function R(a){return"INPUT"===a.tagName&&"checkbox"===a.type||"radio"===a.type}var c="validator",d="n-ok",e="n-error",f="n-tip",g="n-loading",h="n-valid",i="n-invalid",j="msg-box",k="aria-invalid",l="data-rule",m="data-target",n="data-tip",o="data-inputstatus",p="novalidate",q=":verifiable",r=/(\w+)(?:\[(.*)\]$|\((.*)\)$)?/,s=/(?:([^:;\(\[]*):)?(.*)/,t=/[^\x00-\xff]/g,u=/^.*(top|right|bottom|left).*$/,v=/(?:(post|get):)?(.+)/i,w=/<|>/g,x=a.noop,y=a.proxy,z=a.isFunction,A=a.isArray,B=function(a){return"string"==typeof a},C=function(a){return a&&"[object Object]"===Object.prototype.toString.call(a)},D=!window.XMLHttpRequest,E=function(a,c,d){return d===b?a.getAttribute(c):(null===d?a.removeAttribute(c):a.setAttribute(c,""+d),void 0)},F=window.console||{log:x,info:x,warn:x},G={debug:0,timely:1,theme:"default",stopOnError:!1,ignore:"",beforeSubmit:x,valid:x,invalid:x,msgWrapper:"span",msgMaker:function(a){var b,c={error:e,ok:d,tip:f,loading:g}[a.type];return b='<span class="msg-wrap '+c+'" role="alert">',b+=(a.arrow||"")+(a.icon||"")+'<span class="n-msg">'+a.msg+"</span>",b+="</span>"},msgIcon:'<span class="n-icon"></span>',msgArrow:"",msgClass:"",defaultMsg:"{0} is not valid.",loadingMsg:"Validating..."},H={"default":{formClass:"n-default",msgClass:"n-right",showOk:""}};a.fn[c]=function(b){var d=this,e=arguments;return d.is(":input")?d:(!d.is("form")&&(d=this.find("form")),!d.length&&(d=this),d.each(function(){if(B(b)){if("_"===b.charAt(0))return;var d=a(this).data(c);d&&d[b].apply(d,Array.prototype.slice.call(e,1))}else new I(this,b)}),this)},a.fn.isValid=function(a,c){var e,f,d=N(this[0]);return d?(c===b&&(c=!0),d.checkOnly=c,e=this.is(":input")?this:this.find(q),f=d._multiValidate(e,function(b){z(a)&&a.call(null,b),d.checkOnly=!1},!0),z(a)?this:f):!0},a.expr[":"].verifiable=function(a){var b=a.nodeName.toLowerCase();return("input"===b&&"submit"!==a.type&&"button"!==a.type&&"reset"!==a.type||"select"===b||"textarea"===b)&&a.disabled===!1&&!E(a,p)},I.prototype={_init:function(){var b=this,d=b.options,e=b.fields;A(d.groups)&&a.map(d.groups,function(c){if(!B(c.fields)||!z(c.callback))return null;var d=b.$el.find(M(c.fields)),f=function(){return c.callback.call(b,d)};a.extend(f,c),a.map(c.fields.split(" "),function(a){e[a]=e[a]||{},e[a].group=f})}),C(d.fields)&&a.each(d.fields,function(a,b){b&&(e[a]=B(b)?{rule:b}:b)}),b.$el.find(q).each(function(){b._parse(this)}),b.msgOpt={type:"error",pos:Q(d.msgClass),cls:d.msgClass,style:d.msgStyle,icon:d.msgIcon,arrow:d.msgArrow,show:d.msgShow,hide:d.msgHide},b.$el.data(c)||(b.$el.on("submit."+c+" validate."+c,y(b,"_submit")).on("reset."+c,y(b,"_reset")).on("validated.field."+c,q,y(b,"_validatedField")).on("validated.rule."+c,q,y(b,"_validatedRule")).on("focusin."+c+" click."+c+" showtip."+c,q,y(b,"_focus")).on("focusout."+c+" validate."+c,q,y(b,"_blur")).on("click."+c,":radio,:checkbox",y(b,"_click")),d.timely>=2&&b.$el.on("keyup."+c+" paste."+c,q,y(b,"_blur")).on("change."+c,"select",y(b,"_click")),b.$el.data(c,b).addClass("n-"+c+" "+d.formClass),E(b.$el[0],p,!0))},_multiValidate:function(b,c,d){var e=this,f=e.options;return f.ignore&&(b=b.not(f.ignore)),e.isValid=!0,e.deferred={},b.each(function(a,b){var c=e.getField(b);if(c)return e._validate(b,c,d),!e.isValid&&f.stopOnError?!1:void 0}),a.when.apply(null,a.map(e.deferred,function(a){return a})).done(function(){c.call(e,e.isValid)}),e.isValid},_submit:function(c,d){var e=this,f=e.options,g=c.target;if(e.submiting&&"only"!==d)return z(e.submiting)&&e.submiting.call(e),c.preventDefault();if("only"!==d&&("validate"!==c.type||"FORM"===g.tagName)){if(f.beforeSubmit.call(e,g)===!1)return c.preventDefault();if(e.isAjaxSubmit===b)if(null===E(g,"action"))e.isAjaxSubmit=!0;else{var h=a[a._data?"_data":"data"](e.$el[0],"events");e.isAjaxSubmit=h&&h.valid&&a.map(h.valid,function(a){return-1!==a.namespace.indexOf("form")?1:null}).length?!0:!1}return e._reset(),e.submiting=!0,e._multiValidate(e.$el.find(q),function(b){var h,c="focus.field",d=b||2===f.debug?"valid":"invalid";if(b)e.isAjaxSubmit||a(g).trigger("submit",["only"]);else{var j=e.$el.find(":input."+i+":first");j.trigger(c),D&&j.trigger(c),h=a.map(e.errors,function(a){return a})}f[d].call(e,g,h),e.$el.trigger(d+".form",[g,h]),e.submiting=!1},!0),(e.isAjaxSubmit||!a.isEmptyObject(e.deferred))&&c.preventDefault(),e.isValid}},_reset:function(){var b=this;a.each(b.elements,function(c,d){E(d,o,null),E(d,k,null),a(d).removeClass(h+" "+i),b.hideMsg(d)}),b.errors={},b.isValid=!0},_focus:function(a){var b=a.target;this.submiting||""!==b.value&&("false"===E(b,k)||"tip"===E(b,o))||this.showMsg(b,{msg:E(b,n),type:"tip"})},_blur:function(b,c){var f,g,d=this,e=d.options,h=b.target,i=b.type,j=100;if(!c&&"paste"!==i){if("validate"===i)g=!0,j=0;else{if(E(h,"notimely"))return;if(e.timely>=2&&"keyup"!==i)return}if(e.ignore&&a(h).is(e.ignore))return;if("keyup"===i){var k=b.keyCode,l={8:1,9:1,16:1,32:1,46:1};if(9===k&&!h.value)return;if(48>k&&!l[k])return;j=e.timely>=100?e.timely:500}}f=d.getField(h),f&&(j?(f.timeout&&clearTimeout(f.timeout),f.timeout=setTimeout(function(){d._validate(h,f,g)},j)):d._validate(h,f,g))},_click:function(a){this._blur(a,!0)},_parse:function(a){var c,b=this,d=a.name;return(a.id&&"#"+a.id in b.fields||!a.name)&&(d="#"+a.id),d?(c=b.fields[d]||{},c.rule||(c.rule=E(a,l)||""),E(a,l,null),c.rule&&(c.key=d,c.required=-1!==c.rule.indexOf("required"),c.must=c.must||!!c.rule.match(/match|checked/),c.required&&E(a,"aria-required",!0),("timely"in c&&!c.timely||!b.options.timely)&&E(a,"notimely",!0),B(c.target)&&E(a,m,c.target),B(c.tip)&&E(a,n,c.tip),b.fields[d]=b._parseRule(c)),void 0):E(a,l,null)},_parseRule:function(c){var e,d=s.exec(c.rule);if(d)return c.display=d[1],c.rules=[],e=(d[2]||"").split(";"),a.map(e,function(d){var e=r.exec(d);return e?(e[3]&&(e[2]=e[3]),c.rules.push({method:e[1],params:e[2]?a.trim(e[2]).split(", "):b}),void 0):null}),c.vid=0,c.rid=c.rules[0].method,c},_validatedField:function(b,c,d){var e=this,f=e.options,g=b.target,j=c.isValid=!!d.valid;j?d.type="ok":e.submiting&&(e.errors[c.key]=d.msg),a(g).attr(k,!j).addClass(j?h:i).removeClass(j?i:h).trigger((j?"valid":"invalid")+".field",[c,d]),c.old.ret=d,e.elements[c.key]=g,(c.msgMaker||f.msgMaker&&!e.checkOnly)&&(!d.showOk&&d.msg||d.showOk&&f.showOk!==!1?e.showMsg(g,d,c):e.hideMsg(g,d))},_validatedRule:function(c,d,e,f){d=d||g.getField(i);var g=this,h=g.options,i=c.target,j="",k=d.rid,l=!1,m=!1;if(f=f||{},e===!0||e===b?l=!0:(j=P(i,d,k),j||(B(e)?(j=e,e={error:j}):C(e)&&(e.error?j=e.error:(l=!0,e.ok&&B(e.ok)&&(m=!0),j=e.ok))),f.msg=(l?j:j||g.messages[k]||G.defaultMsg).replace("{0}",d.display||"")),l){if(f.valid=!0,!m){var n=d.ok||E(i,"data-ok");n?(m=!0,f.msg=n):B(h.showOk)&&(m=!0,f.msg=h.showOk)}f.showOk=m,a(i).trigger("valid.rule",[k,f.msg])}else g.isValid=!1,a(i).trigger("invalid.rule",[k,f.msg]);h.debug&&F[l?"info":"warn"](d.vid+": "+k+" -> "+(f.msg||!0)),l&&d.old.value!==b&&d.old.value!==i.value?(d.vid=0,g._checkRule(i,d)):l&&d.vid<d.rules.length-1?(d.vid++,g._checkRule(i,d)):(d.vid=0,a(i).trigger("validated.field",[d,f]))},_checkRule:function(c,d){var f,e=this,g=d.key,h=d.rules[d.vid],i=h.method,j=h.params;if(!e.submiting||!e.deferred[g])if(d.rid=i,d.old.value=c.value,f=(O(c,i)||e.rules[i]||function(){return!0}).call(e,c,j,d),C(f)&&z(f.then)){var k=function(a){return B(a)||C(a)&&("error"in a||"ok"in a)?a:void 0};e.deferred[g]=f,!e.checkOnly&&e.showMsg(c,{type:"loading",msg:e.options.loadingMsg},d),f.then(function(e,f,g){var i,h=g.responseText;""===h?h=!0:"{"===h.charAt(0)&&(h=a.parseJSON(h)||{},i=k(h),i===b&&(i=k(h.data)),h=i||!0),a(c).trigger("validated.rule",[d,h])},function(b,e){a(c).trigger("validated.rule",[d,e])}),d.isValid=b}else a(c).trigger("validated.rule",[d,f])},_validate:function(c,d,e){if(!c.disabled&&!E(c,p)){d.rules||this._parse(c);var k,l,f=this,g=f.options,h=a(c),i={},j=d.group,m="tip"===E(c,o),n=d.isValid=!0;if(k=d.old=d.old||{},e=e||d.must,j&&(a.extend(i,j),l=j.call(f),l!==!0?(B(l)&&(l={error:l}),d.vid=0,d.rid="group",n=!1):(l=b,f.hideMsg(c,i))),n&&!d.required&&""===c.value){if(m)return;if(f._focus({target:c}),k.value="",!R(c))return h.trigger("validated.field",[d,{valid:!0}]),void 0}else if(!e&&k&&k.ret!==b&&k.value===c.value){if(k.ret.valid||(f.isValid=!1),m)return;if(""!==c.value)return i=k.ret,h.trigger("validated.field",[d,i]),void 0}g.debug&&F.log(d.key),l!==b?h.trigger("validated.rule",[d,l,i]):d.rule&&f._checkRule(c,d)}},_getMsgOpt:function(b){return a.extend({},this.msgOpt,B(b)?{msg:b}:b)},getField:function(a){var c,b=this;return c=a.id&&"#"+a.id in b.fields||!a.name?"#"+a.id:a.name,E(a,l)&&b._parse(a),b.fields[c]},test:function(c,d){var f,h,i,e=this,g=r.exec(d);return g?(g[3]&&(g[2]=g[3]),h=g[1],i=g[2]?a.trim(g[2]).split(", "):b,h in e.rules&&(f=e.rules[h].call(e,c,i)),f===!0||f===b||f):!0},getRangeMsg:function(a,b,c,d){if(b){var e=this,f=e.messages[c]||"",g=b[0].split("~"),h=g[0],i=g[1],j="rg",k=[""],l=+a===+a;if(2===g.length){if(h&&i){if(l&&a>=+h&&+i>=a)return!0;k=k.concat(g)}else if(h&&!i){if(l&&a>=+h)return!0;k.push(h),j="gt"}else if(!h&&i){if(l&&+i>=a)return!0;k.push(i),j="lt"}}else{if(a===+h)return!0;k.push(h),j="eq"}return f&&(d&&f[j+d]&&(j+=d),k[0]=f[j]),e.renderMsg.apply(null,k)}},renderMsg:function(){var a=arguments,b=a[0],c=a.length;if(b){for(;--c;)b=b.replace("{"+c+"}",a[c]);return b}},_getMsgDOM:function(b,c){var e,f,g,d=a(b);if(d.is(":input")?(g=c.target||E(b,m),g&&(g=this.$el.find(g),g.length&&(g.is(":input")?b=g.get(0):e=g)),e||(f=!R(b)&&b.id?b.id:b.name,e=this.$el.find(this.options.msgWrapper+"."+j+'[for="'+f+'"]'))):e=d,!e.length)if(d=this.$el.find(g||b),e=a("<"+this.options.msgWrapper+">").attr({"class":j+(c.cls?" "+c.cls:""),style:c.style||"","for":f}),R(b)){var h=d.parent();e.appendTo(h.is("label")?h.parent():h)}else e[c.pos&&"right"!==c.pos?"insertBefore":"insertAfter"](d);return e},showMsg:function(b,c,d){if(c=this._getMsgOpt(c),c.msg||c.showOk){b=a(b).get(0),E(b,o,c.type);var e=this._getMsgDOM(b,c),f=e[0].className;!u.test(f)&&e.addClass(c.cls),D&&"bottom"===c.pos&&(e[0].style.marginTop=a(b).outerHeight()+"px"),e.html(((d||this.getField(b)).msgMaker||this.options.msgMaker).call(this,c)),e[0].style.display="",z(c.show)&&c.show.call(this,e,c.type)}},hideMsg:function(b,c){b=a(b).get(0),c=this._getMsgOpt(c);var d=this._getMsgDOM(b,c);d.length&&(z(c.hide)?c.hide.call(this,d,c.type):d[0].style.display="none")},mapMsg:function(b){var c=this;a.each(b,function(a,b){var d=c.elements[a]||c.$el.find(':input[name="'+a+'"]')[0];c.showMsg(d,b)})},setMsg:function(a){new K(a,this.messages)},setRule:function(b){new J(b,this.rules),a.map(this.fields,function(a){a.old={}})},setField:function(b,c){var d=this,e={};if(B(b)){if(null===c)return a.map(b.split(" "),function(a){a&&d.fields[a]&&(d.fields[a]=null)}),void 0;c&&(e[b]=c)}else C(b)&&(e=b);d.options.fields?a.extend(d.options.fields,e):d.options.fields=e,d._init()},holdSubmit:function(a){a===b&&(a=!0),this.submiting=a},destroy:function(){this._reset(),this.$el.off("."+c).removeData(c)}},a(function(){a("body").on("focusin",":input["+l+"]",function(){var b=this,c=N(b);c?(E(b,l)&&c._parse(b),a(b).trigger("focusin")):E(b,l,null)}).on("click submit","form",function(b){if(!E(this,"novalidate")){var e,d=a(this);d.data(c)||(e=d[c]().data(c),a.isEmptyObject(e.fields)?(E(this,p,!0),d.removeData(c)):"submit"===b.type&&e._submit(b))}})}),new J({required:function(b){return!!a.trim(b.value)},integer:function(a,b){var c,d="0|",e="[1-9]\\d*",f=b?b[0]:"*";switch(f){case"+":c=e;break;case"-":c="-"+e;break;case"+0":c=d+e;break;case"-0":c=d+"-"+e;break;default:c=d+"-?"+e}return c="^(?:"+c+")$",new RegExp(c).test(a.value)||this.messages.integer[f]},match:function(b,d,e){var f,g,h,i,k,l,m,j="eq";if(d&&(1===d.length?h=d[0]:(j=d[0],h=d[1]),k="#"===h.charAt(0)?h:':input[name="'+h+'"]',l=this.$el.find(k)[0]))switch(m=this.getField(l),e.init_match||(this.$el.on("valid.field."+c,k,function(){!e.isValid&&b.value&&a(b).trigger("validate")}),e.init_match=1),i=this.messages.match[j].replace("{1}",m.display||h),f=b.value,g=l.value,j){case"lt":return+g>+f||i;case"lte":return+g>=+f||i;case"gte":return+f>=+g||i;case"gt":return+f>+g||i;default:return f===g||i}},range:function(a,b){return this.getRangeMsg(+a.value,b,"range")},checked:function(b,c){if(!R(b))return!0;var d=this.$el.find('input[name="'+b.name+'"]').filter(function(){return!this.disabled&&this.checked&&a(this).is(":visible")}).length;return c?this.getRangeMsg(d,c,"checked"):!!d||this.messages.required},length:function(a,b){var c=a.value,d=(b[1]?c.replace(t,"xx"):c).length;return b&&"~"===b[0].charAt(0)&&(b[0]="0"+b[0]),this.getRangeMsg(d,b,"length",b[1]?"_2":"")},remote:function(b,c){var e,d=this,f={};return c?(e=v.exec(c[0]),f[b.name]=b.value,c[1]&&a.map(c.slice(1),function(a){f[a]=d.$el.find(':input[name="'+a+'"]').val()}),a.ajax({url:e[2],async:!0,type:e[1]||"POST",data:f,cache:!1})):!0},filter:function(a,b){var c=b?new RegExp("["+b[0]+"]","g"):w;return a.value=a.value.replace(c,""),!0}}),a[c]={config:function(b){a.each(b,function(a,b){"rules"===a?new J(b):"messages"===a?new K(b):G[a]=b})},setTheme:function(b,c){C(b)?a.each(b,function(a,b){H[a]=b}):B(b)&&C(c)&&(H[b]=c)}}}(jQuery);